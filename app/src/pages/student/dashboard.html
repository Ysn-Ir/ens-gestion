<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Etudiant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
        }
    </style>
</head>
<body>
    <button id="logoutBtn" class="btn btn-danger logout-btn">
        Déconnexion
    </button>

    <div class="container mt-5">
        <h1>Bienvenue <span id="fullname"></span> !</h1>
        <div class="mt-4">
            <p><strong>CIN :</strong> <span id="cin"></span></p>
            <p><strong>CNE :</strong> <span id="cne"></span></p>
            <p><strong>Date de naissance :</strong> <span id="birthdate"></span></p>
            <p><strong>Nationalité :</strong> <span id="nationalite"></span></p>
            <p><strong>Téléphone :</strong> <span id="telephone"></span></p>
            <p><strong>Adresse :</strong> <span id="adresse"></span></p>
            <p><strong>Groupe :</strong> <span id="groupId"></span></p>
            <p><strong>Email :</strong> <span id="email"></span></p>
            <p><strong>Rôle :</strong> <span id="role"></span></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const user = JSON.parse(localStorage.getItem('userData'));

            if (!user) {
                window.location.href = 'http://localhost/ens-gestion/app/src/pages/auth/login.html';
                return;
            }

            // Récupérer les infos détaillées de l'étudiant
            fetch(`http://localhost/ens-gestion/api/student.php?action=me`, {
                method: 'GET',
                credentials: 'include'
            })
                .then(response => response.json())
                .then(json => {
                    const student = json.data.student;

                    document.getElementById('fullname').textContent = `${student.prenom} ${student.nom}`;
                    document.getElementById('cin').textContent = student.cin;
                    document.getElementById('cne').textContent = student.cne;
                    document.getElementById('birthdate').textContent = student.date_naissance;
                    document.getElementById('nationalite').textContent = student.nationalite;
                    document.getElementById('telephone').textContent = student.telephone;
                    document.getElementById('adresse').textContent = student.adresse;
                    document.getElementById('groupId').textContent = student.group_id;
                    document.getElementById('email').textContent = student.email;
                    document.getElementById('role').textContent = user.role;
                })
                .catch(err => {
                    console.error('Erreur lors de la récupération des infos étudiant:', err);
                    window.location.href = 'http://localhost/ens-gestion/app/src/pages/auth/login.html';
                });

            // Gestion de la déconnexion
            document.getElementById('logoutBtn').addEventListener('click', function () {
                localStorage.removeItem('userData');
                window.location.href = 'http://localhost/ens-gestion/app/src/pages/auth/login.html';
            });
        });
    </script>
</body>
</html>
